<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
	xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.9.xsd">
	
	<changeSet id="001-1" author="birukov">
		<comment>Create tbl_writer table</comment>
		
		<createTable tableName="tbl_writer" schemaName="distcomp">
			<column name="id" type="BIGINT">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="login" type="VARCHAR(64)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="password" type="VARCHAR(128)">
				<constraints nullable="false"/>
			</column>
			<column name="firstname" type="VARCHAR(64)">
				<constraints nullable="false"/>
			</column>
			<column name="lastname" type="VARCHAR(64)">
				<constraints nullable="false"/>
			</column>
		</createTable>
		
		<createSequence sequenceName="seq_writer_id" schemaName="distcomp"
						startValue="2" incrementBy="1"/>
	</changeSet>
	
	<changeSet id="001-2" author="birukov">
		<comment>Create tbl_tweet table</comment>
		
		<createTable tableName="tbl_tweet" schemaName="distcomp">
			<column name="id" type="BIGINT">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="writer_id" type="BIGINT">
				<constraints nullable="false"/>
			</column>
			<column name="title" type="VARCHAR(64)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="content" type="VARCHAR(2048)">
				<constraints nullable="false"/>
			</column>
			<column name="created" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
				<constraints nullable="false"/>
			</column>
			<column name="modified" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
				<constraints nullable="false"/>
			</column>
		</createTable>
		
		<addForeignKeyConstraint 
			baseTableName="tbl_tweet" baseTableSchemaName="distcomp"
			baseColumnNames="writer_id"
			referencedTableName="tbl_writer" referencedTableSchemaName="distcomp"
			referencedColumnNames="id"
			constraintName="fk_tweet_writer"
			onDelete="CASCADE"/>
			
		<createSequence sequenceName="seq_tweet_id" schemaName="distcomp"
						startValue="1" incrementBy="1"/>
	</changeSet>
	
	<changeSet id="001-3" author="birukov">
		<comment>Create tbl_label table</comment>
		
		<createTable tableName="tbl_label" schemaName="distcomp">
			<column name="id" type="BIGINT">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="VARCHAR(32)">
				<constraints nullable="false" unique="true"/>
			</column>
		</createTable>
		
		<createSequence sequenceName="seq_label_id" schemaName="distcomp"
						startValue="1" incrementBy="1"/>
	</changeSet>
	
	<changeSet id="001-4" author="birukov">
		<comment>Create tbl_tweet_label junction table</comment>
		
		<createTable tableName="tbl_tweet_label" schemaName="distcomp">
			<column name="id" type="BIGINT">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="tweet_id" type="BIGINT">
				<constraints nullable="false"/>
			</column>
			<column name="label_id" type="BIGINT">
				<constraints nullable="false"/>
			</column>
		</createTable>
		
		<addForeignKeyConstraint 
			baseTableName="tbl_tweet_label" baseTableSchemaName="distcomp"
			baseColumnNames="tweet_id"
			referencedTableName="tbl_tweet" referencedTableSchemaName="distcomp"
			referencedColumnNames="id"
			constraintName="fk_tweet_label_tweet"
			onDelete="CASCADE"/>
			
		<addForeignKeyConstraint 
			baseTableName="tbl_tweet_label" baseTableSchemaName="distcomp"
			baseColumnNames="label_id"
			referencedTableName="tbl_label" referencedTableSchemaName="distcomp"
			referencedColumnNames="id"
			constraintName="fk_tweet_label_label"
			onDelete="CASCADE"/>
			
		<createSequence sequenceName="seq_tweet_label_id" schemaName="distcomp"
						startValue="1" incrementBy="1"/>
	</changeSet>
	
</databaseChangeLog>